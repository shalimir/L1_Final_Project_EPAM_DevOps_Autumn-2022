#!/bin/bash

echo "###################################################################################################"
echo "================================Install pip for Python 3==========================================="
echo "###################################################################################################"
sudo apt-get install gpgv curl wget -y
sudo apt update -y
    apt-cache policy ansible
echo "###################################################################################################"
echo "================================Install ANSIBLE===================================================="
echo "###################################################################################################"
sudo apt update -y
    sudo apt install ansible -y
sudo apt install python3-pip
pip install boto3

echo "###################################################################################################"
echo "================================Check version======================================================"
echo "###################################################################################################"

# Check version
ansible --version


echo "###################################################################################################"
echo "================================Setting Up the Inventory File======================================"
echo "###################################################################################################"
    cd /
    cd /home/ubuntu/
    mkdir ansible
    cd ansible

echo "###################################################################################################"
echo "=====================================     HOSTS      =============================================="
echo "###################################################################################################"

cat << EOF > hosts
# !!! hosts !!!

[prod]
#ip-192-168-11-10    ansible_hosts=54.217.163.192 ansible_user=ubuntu ansible_ssh_private_key_file=/home/ubuntu/.ssh/ec2-key-prod.pem
ubuntu@ec2-34-242-29-187.eu-west-1.compute.amazonaws.com

[CIQA]
#ip-192-168-11-11    ansible_hosts=192.168.11.11 ansible_user=ubuntu ansible_ssh_private_key_file=/home/ubuntu/.ssh/ec2-key-prod.pem
ubuntu@ec2-34-242-144-184.eu-west-1.compute.amazonaws.com

[db]
ip-192-168-2-154     ansible_hosts=192.168.2.154 ansible_user=ubuntu ansible_ssh_private_key_file=/home/ubuntu/.ssh/ec2-key-dev.pem
EOF

echo "###################################################################################################"
echo "================================           ansible.cfg       ======================================"
echo "###################################################################################################"

    cd /
    cd /home/ubuntu/ansible
    ansible-galaxy install geerlingguy.mysql  -p roles
echo
    cat << EOF > ansible.cfg
#!!! ansible.cfg  !!!
[defaults]
host_key_checking = false
inventory = /home/ubuntu/ansible/hosts
EOF


echo "###################################################################################################"
echo "================================         ping                ======================================"
echo "###################################################################################################"
    cd $HOME/ansible
    ansible -i hosts all -m ping
echo "=========================================================="

echo "###################################################################################################"
echo "================================          EXIT               ======================================"
echo "###################################################################################################"
