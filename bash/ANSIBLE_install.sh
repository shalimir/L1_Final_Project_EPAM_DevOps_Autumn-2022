#!/bin/bash

echo "###################################################################################################"
echo "================================Install pip for Python 3==========================================="
echo "###################################################################################################"
sudo apt-get install gpgv curl wget -y
sudo apt update -y
    apt-cache policy ansible
echo "###################################################################################################"
echo "================================Install ANSIBLE===================================================="
echo "###################################################################################################"
sudo apt update -y
    sudo apt install ansible -y
pip install boto3

echo "###################################################################################################"
echo "================================Check version======================================================"
echo "###################################################################################################"

# Check version
ansible --version


echo "###################################################################################################"
echo "================================Setting Up the Inventory File======================================"
echo "###################################################################################################"
    cd /
    cd /home/ubuntu/
    mkdir ansible
    cd ansible

echo "###################################################################################################"
echo "=====================================     HOSTS      =============================================="
echo "###################################################################################################"

cat << EOF > hosts
# !!! hosts !!!

[prod]
ip-10-0-2-191    ansible_hosts=10.0.2.191 ansible_user=ubuntu ansible_ssh_private_key_file=/home/ubuntu/.ssh/ec2-key.pem

[db]
ip-10-0-2-64     ansible_hosts=10.0.2.64 ansible_user=ubuntu ansible_ssh_private_key_file=/home/ubuntu/.ssh/ec2-key.pem
EOF

echo "###################################################################################################"
echo "================================           ansible.cfg       ======================================"
echo "###################################################################################################"
    cd /
    cd /home/ubuntu/ansible
    ansible-galaxy install geerlingguy.mysql  -p roles
echo
    cat << EOF > ansible.cfg
#!!! ansible.cfg  !!!
[defaults]
host_key_checking = false
inventory = /hosts.txt
EOF


echo "###################################################################################################"
echo "================================         ping                ======================================"
echo "###################################################################################################"
    cd $HOME/ansible
    ansible -i hosts all -m ping
echo "=========================================================="

echo "###################################################################################################"
echo "================================          EXIT               ======================================"
echo "###################################################################################################"
